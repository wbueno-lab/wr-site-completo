<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Erros de Console</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .error-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .error-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a8b;
        }
        .error-log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>üêõ Teste de Erros de Console - WR Capacetes</h1>
    <p>Esta p√°gina testa diferentes tipos de erros que podem aparecer no console do navegador.</p>
    
    <div id="status" class="status">
        <strong>Status:</strong> Pronto para testes. Abra o DevTools (F12) para ver os erros.
    </div>

    <div class="error-section">
        <h3>1. Teste de Conectividade</h3>
        <button onclick="testConnectivity()">Testar Conectividade</button>
        <button onclick="testSupabase()">Testar Supabase</button>
        <button onclick="testMercadoPago()">Testar Mercado Pago</button>
        <div id="connectivity-log" class="error-log" style="display: none;"></div>
    </div>

    <div class="error-section">
        <h3>2. Teste de Erros JavaScript</h3>
        <button onclick="testJavaScriptError()">TypeError</button>
        <button onclick="testReferenceError()">ReferenceError</button>
        <button onclick="testSyntaxError()">SyntaxError</button>
        <div id="js-log" class="error-log" style="display: none;"></div>
    </div>

    <div class="error-section">
        <h3>3. Teste de Erros de Rede</h3>
        <button onclick="testNetworkError()">Erro 404</button>
        <button onclick="testCORSError()">Erro CORS</button>
        <button onclick="testCSPError()">Erro CSP</button>
        <div id="network-log" class="error-log" style="display: none;"></div>
    </div>

    <div class="error-section">
        <h3>4. An√°lise de Erros</h3>
        <button onclick="analyzeErrors()">Analisar Erros Capturados</button>
        <button onclick="clearLogs()">Limpar Logs</button>
        <div id="analysis-log" class="error-log" style="display: none;"></div>
    </div>

    <script>
        // Array para capturar erros
        let capturedErrors = [];
        let originalConsoleError = console.error;
        let originalConsoleWarn = console.warn;

        // Interceptar console.error
        console.error = function(...args) {
            capturedErrors.push({
                type: 'error',
                message: args.join(' '),
                timestamp: new Date(),
                stack: new Error().stack
            });
            originalConsoleError.apply(console, args);
        };

        // Interceptar console.warn
        console.warn = function(...args) {
            capturedErrors.push({
                type: 'warn',
                message: args.join(' '),
                timestamp: new Date(),
                stack: new Error().stack
            });
            originalConsoleWarn.apply(console, args);
        };

        // Capturar erros n√£o tratados
        window.addEventListener('error', function(event) {
            capturedErrors.push({
                type: 'unhandled',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                error: event.error,
                timestamp: new Date()
            });
        });

        // Capturar promessas rejeitadas
        window.addEventListener('unhandledrejection', function(event) {
            capturedErrors.push({
                type: 'rejection',
                message: event.reason?.toString() || 'Unhandled Promise Rejection',
                timestamp: new Date()
            });
        });

        function updateStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
        }

        function showLog(elementId, content) {
            const logElement = document.getElementById(elementId);
            logElement.style.display = 'block';
            logElement.textContent = content;
        }

        // Testes de Conectividade
        async function testConnectivity() {
            updateStatus('Testando conectividade...');
            try {
                const response = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    cache: 'no-cache'
                });
                const data = await response.json();
                showLog('connectivity-log', `‚úÖ Conectividade OK: ${JSON.stringify(data, null, 2)}`);
                updateStatus('Teste de conectividade conclu√≠do');
            } catch (error) {
                console.error('‚ùå Erro de conectividade:', error);
                showLog('connectivity-log', `‚ùå Erro: ${error.message}`);
                updateStatus('Erro de conectividade detectado', true);
            }
        }

        async function testSupabase() {
            updateStatus('Testando Supabase...');
            try {
                const response = await fetch('https://fflomlvtgaqbzrjnvqaz.supabase.co/rest/v1/', {
                    method: 'GET',
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmbG9tbHZ0Z2FxYnpyam52cWF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NjI2MjcsImV4cCI6MjA3MzEzODYyN30.AjI-ZeoLswTl9D7EsjW1y2vZoctX0CSDI2B_FVXKkd4'
                    }
                });
                showLog('connectivity-log', `‚úÖ Supabase Status: ${response.status} ${response.statusText}`);
                updateStatus('Teste Supabase conclu√≠do');
            } catch (error) {
                console.error('‚ùå Erro Supabase:', error);
                showLog('connectivity-log', `‚ùå Erro Supabase: ${error.message}`);
                updateStatus('Erro Supabase detectado', true);
            }
        }

        async function testMercadoPago() {
            updateStatus('Testando Mercado Pago...');
            try {
                const response = await fetch('https://api.mercadopago.com', {
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                showLog('connectivity-log', `‚úÖ Mercado Pago Status: ${response.status} ${response.statusText}`);
                updateStatus('Teste Mercado Pago conclu√≠do');
            } catch (error) {
                console.error('‚ùå Erro Mercado Pago:', error);
                showLog('connectivity-log', `‚ùå Erro Mercado Pago: ${error.message}`);
                updateStatus('Erro Mercado Pago detectado', true);
            }
        }

        // Testes de Erros JavaScript
        function testJavaScriptError() {
            try {
                const obj = null;
                obj.nonExistentProperty.someMethod();
            } catch (error) {
                console.error('‚ùå TypeError demonstrativo:', error);
                showLog('js-log', `TypeError: ${error.message}`);
            }
        }

        function testReferenceError() {
            try {
                undefinedVariable.someMethod();
            } catch (error) {
                console.error('‚ùå ReferenceError demonstrativo:', error);
                showLog('js-log', `ReferenceError: ${error.message}`);
            }
        }

        function testSyntaxError() {
            try {
                eval('function invalidSyntax() { if (true { }');
            } catch (error) {
                console.error('‚ùå SyntaxError demonstrativo:', error);
                showLog('js-log', `SyntaxError: ${error.message}`);
            }
        }

        // Testes de Erros de Rede
        async function testNetworkError() {
            try {
                await fetch('/nonexistent-endpoint');
            } catch (error) {
                console.error('‚ùå Erro de rede 404:', error);
                showLog('network-log', `Erro 404: ${error.message}`);
            }
        }

        async function testCORSError() {
            try {
                await fetch('https://example.com/api/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ test: 'data' })
                });
            } catch (error) {
                console.error('‚ùå Poss√≠vel erro CORS:', error);
                showLog('network-log', `Erro CORS: ${error.message}`);
            }
        }

        function testCSPError() {
            try {
                const script = document.createElement('script');
                script.innerHTML = 'console.log("Inline script - pode violar CSP");';
                document.body.appendChild(script);
            } catch (error) {
                console.error('‚ùå Poss√≠vel viola√ß√£o CSP:', error);
                showLog('network-log', `Erro CSP: ${error.message}`);
            }
        }

        // An√°lise de Erros
        function analyzeErrors() {
            if (capturedErrors.length === 0) {
                showLog('analysis-log', 'Nenhum erro capturado ainda.');
                return;
            }

            const analysis = {
                total: capturedErrors.length,
                byType: {},
                recent: capturedErrors.slice(-5)
            };

            capturedErrors.forEach(error => {
                analysis.byType[error.type] = (analysis.byType[error.type] || 0) + 1;
            });

            const report = `
üìä RELAT√ìRIO DE ERROS
====================
Total de erros: ${analysis.total}

Por tipo:
${Object.entries(analysis.byType).map(([type, count]) => `  ${type}: ${count}`).join('\n')}

√öltimos 5 erros:
${analysis.recent.map((error, i) => `  ${i + 1}. [${error.type}] ${error.message} (${error.timestamp.toLocaleTimeString()})`).join('\n')}
            `;

            showLog('analysis-log', report);
        }

        function clearLogs() {
            capturedErrors = [];
            document.querySelectorAll('.error-log').forEach(log => {
                log.style.display = 'none';
                log.textContent = '';
            });
            updateStatus('Logs limpos. Pronto para novos testes.');
        }

        // Inicializa√ß√£o
        updateStatus('P√°gina carregada. Console interceptado. Pronto para testes!');
        console.log('üîÑ Sistema de captura de erros iniciado');
    </script>
</body>
</html>
